;The following is the code to initialize and display ASCII characters on a SSD1306 OLED Display.
;The code is written for 8051 but it can be extended for any microcontroller that can implement I2C communication.
;FUNCTIONS USED
;	I2C_start		-
;	I2C_stop		-
;	I2C_send		- @Resources Used - R6,C :@Param - A (Byte to send)
;	DELAY			- @Resources Used - R2,R3
;	OLED_DIS_CHAR	- @Resources Used - R4,C,DPTR,B :@Param - A (ASCII character) :@Functions called - I2C_send, 
;	REP_SEQ			- @Resources Used - R6,C :@Param - DPTR (Pointer to Sequence of bytes), R1 (No. of bytes to send), A (Must be cleared before use) 
;				      :@Functions called - I2C_send, DELAY
; 	CLEAR_SCREEN	- @Resources Used - R5,R4 :@Param - A (Byte to send) :@Functions called - I2C_send
;	OLED COMMAND SEQUENCES - 

ORG 00H
	SDA EQU P2.1
	SCL EQU P2.2
	MOV P3, #0FFH ;Turn Off LED 
	
;CODE BEGINS
	ACALL I2C_start
		;send the sequence to initialize oled display
		MOV DPTR, #OLEDINITSEQ
		MOV R1, #33
		CLR A
		LCALL REP_SEQ
	LCALL I2C_stop
		MOV P3, #0FFH
	
	;send the sequence to enable OLED to read DATA to be displayed
	LCALL I2C_start
		MOV DPTR, #OLEDREADSEQ
		MOV R1, #2
		CLR A
		LCALL REP_SEQ
	
	;sending DATA to be displayed	
		
		LCALL CLEAR_SCREEN
		
		MOV A,#'8'
		LCALL OLED_DIS_CHAR
		MOV A,#'0'
		LCALL OLED_DIS_CHAR
		MOV A,#'5'
		LCALL OLED_DIS_CHAR
		MOV A,#'1'
		LCALL OLED_DIS_CHAR
		MOV A,#' '
		LCALL OLED_DIS_CHAR
		MOV A,#'R'
		LCALL OLED_DIS_CHAR
		MOV A,#'O'
		LCALL OLED_DIS_CHAR
		MOV A,#'C'
		LCALL OLED_DIS_CHAR
		MOV A,#'K'
		LCALL OLED_DIS_CHAR
		MOV A,#'S'
		LCALL OLED_DIS_CHAR
		

	LCALL I2C_stop
		MOV P3,#0FFH 	;LED OFF
		WAIT: SJMP WAIT	;CODE ENDS

	;Creating the start condition
	I2C_start:
		CLR SDA
		SETB SDA
		SETB SCL
		SETB SCL
		CLR SDA
		CLR SCL
		RET

	;Creating the stop condition
	I2C_stop:
		CLR SCL
		CLR SDA
		SETB SCL
		SETB SDA
		RET
	
	;Creating the send AND receive acknowledge condition
	I2C_send:
		MOV R6, #08;
		REP:
			CLR SCL
			RLC A
			MOV SDA, C
			SETB SCL
			DJNZ R6, REP
		CLR SCL
		SETB SDA
		SETB SCL
		WAIT1:	
			MOV C, SDA
			JC WAIT1
		CLR A
		RLC A
		MOV P3,A
		CLR SCL
		RET

	;Delay of approx 2 seconds
	DELAY:
		MOV R2,#200
		AGAIN: MOV R3,#250
		HERE: NOP
			NOP
			DJNZ R3,HERE
			DJNZ R2,AGAIN
			RET
	
	OLED_DIS_CHAR:
			CLR C
			SUBB A,#32
			MOV R4,A
			MOV DPTR, #OLEDCHARDISP
			JZ CONTINUE
			BT1:
				MOV B,#5
				BT2:
					INC DPTR
					DJNZ B,BT2
				DJNZ R4,BT1
			CONTINUE:
			CLR A
			MOV B,#5
			BT3:MOVC A,@A+DPTR
			ACALL I2C_send
			INC DPTR
			DJNZ B,BT3
		RET
	
	
	REP_SEQ: 
		MOVC A, @A+DPTR
		ACALL I2C_send
		ACALL DELAY
		MOV P3, #0FFH
		ACALL DELAY
		INC DPTR
		DJNZ R1, REP_SEQ
		RET
		
	CLEAR_SCREEN:
		CLR C
			MOV DPTR, #OLEDCHARDISP
			CLR A
			MOV R4,#8
			MARK1: 
				MOV R5,#128
				MARK2:	
				CLR A
				MOVC A,@A+DPTR
				ACALL I2C_send
			DJNZ R5,MARK2
			DJNZ R4,MARK1
		RET
		
		
		
	
	;OLED Command Sequences
	OLEDINITSEQ: DB 78H, 00H, 0AEH, 0A8H, 3FH, 0D3H, 00H, 40H, 0A1H, 0C8H, 0DAH, 12H, 81H, 7FH, 0A4H, 0A6H, 0D5H, 80H, 8DH, 14H, 0D9H, 0F1H, 0DBH, 40H, 20H, 00H, 0AFH, 21H, 00H, 7FH, 22H, 00H, 07H
	OLEDREADSEQ: DB 78H, 40H
	
	;Pixel HEX Values for OLED ASCII Characters from 'Space'. E.g the first 5 bytes are used to display 'Space' on OLED. The second five bytes are for displaying '!' and so on 
	OLEDCHARDISP: DB 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x00, 0x00, 0x00, 0x07, 0x00, 0x07, 0x00, 0x14, 0x7f, 0x14, 0x7f, 0x14, 0x24, 0x2a, 0x7f, 0x2a, 0x12, 0x23, 0x13, 0x08, 0x64, 0x62, 0x36, 0x49, 0x55, 0x22, 0x50, 0x00, 0x05, 0x03, 0x00, 0x00, 0x00, 0x1c, 0x22, 0x41, 0x00, 0x00, 0x41, 0x22, 0x1c, 0x00, 0x14, 0x08, 0x3E, 0x08, 0x14, 0x08, 0x08, 0x3E, 0x08, 0x08, 0x00, 0x00, 0xA0, 0x60, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x00, 0x60, 0x60, 0x00, 0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x3E
   OLEDCHARDISP1: DB 0x51, 0x49, 0x45, 0x3E, 0x00, 0x42, 0x7F, 0x40, 0x00, 0x42, 0x61, 0x51, 0x49, 0x46, 0x21, 0x41, 0x45, 0x4B, 0x31, 0x18, 0x14, 0x12, 0x7F, 0x10, 0x27, 0x45, 0x45, 0x45, 0x39, 0x3C, 0x4A, 0x49, 0x49, 0x30, 0x01, 0x71, 0x09, 0x05, 0x03, 0x36, 0x49, 0x49, 0x49, 0x36, 0x06, 0x49, 0x49, 0x29, 0x1E, 0x00, 0x36, 0x36, 0x00, 0x00, 0x00, 0x56, 0x36, 0x00, 0x00, 0x08, 0x14, 0x22, 0x41, 0x00, 0x14, 0x14, 0x14, 0x14, 0x14, 0x00, 0x41, 0x22, 0x14, 0x08, 0x02, 0x01, 0x51, 0x09, 0x06, 0x32, 0x49
   OLEDCHARDISP2: DB 0x59, 0x51, 0x3E, 0x7C, 0x12, 0x11, 0x12, 0x7C, 0x7F, 0x49, 0x49, 0x49, 0x36, 0x3E, 0x41, 0x41, 0x41, 0x22, 0x7F, 0x41, 0x41, 0x22, 0x1C, 0x7F, 0x49, 0x49, 0x49, 0x41, 0x7F, 0x09, 0x09, 0x09, 0x01, 0x3E, 0x41, 0x49, 0x49, 0x7A, 0x7F, 0x08, 0x08, 0x08, 0x7F, 0x00, 0x41, 0x7F, 0x41, 0x00, 0x20, 0x40, 0x41, 0x3F, 0x01, 0x7F, 0x08, 0x14, 0x22, 0x41, 0x7F, 0x40, 0x40, 0x40, 0x40, 0x7F, 0x02, 0x0C, 0x02, 0x7F, 0x7F, 0x04, 0x08, 0x10, 0x7F, 0x3E, 0x41, 0x41, 0x41, 0x3E, 0x7F, 0x09, 0x09
   OLEDCHARDISP3: DB 0x09, 0x06, 0x3E, 0x41, 0x51, 0x21, 0x5E, 0x7F, 0x09, 0x19, 0x29, 0x46, 0x46, 0x49, 0x49, 0x49, 0x31, 0x01, 0x01, 0x7F, 0x01, 0x01, 0x3F, 0x40, 0x40, 0x40, 0x3F, 0x1F, 0x20, 0x40, 0x20, 0x1F, 0x3F, 0x40, 0x38, 0x40, 0x3F, 0x63, 0x14, 0x08, 0x14, 0x63, 0x07, 0x08, 0x70, 0x08, 0x07, 0x61, 0x51, 0x49, 0x45, 0x43, 0x00, 0x7F, 0x41, 0x41, 0x00, 0x55, 0xAA, 0x55, 0xAA, 0x55, 0x00, 0x41, 0x41, 0x7F, 0x00, 0x04, 0x02, 0x01, 0x02, 0x04, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x03, 0x05, 0x00
   OLEDCHARDISP4: DB 0x00, 0x20, 0x54, 0x54, 0x54, 0x78, 0x7F, 0x48, 0x44, 0x44, 0x38, 0x38, 0x44, 0x44, 0x44, 0x20, 0x38, 0x44, 0x44, 0x48, 0x7F, 0x38, 0x54, 0x54, 0x54, 0x18, 0x08, 0x7E, 0x09, 0x01, 0x02, 0x18, 0xA4, 0xA4, 0xA4, 0x7C, 0x7F, 0x08, 0x04, 0x04, 0x78, 0x00, 0x44, 0x7D, 0x40, 0x00, 0x40, 0x80, 0x84, 0x7D, 0x00, 0x7F, 0x10, 0x28, 0x44, 0x00, 0x00, 0x41, 0x7F, 0x40, 0x00, 0x7C, 0x04, 0x18, 0x04, 0x78, 0x7C, 0x08, 0x04, 0x04, 0x78, 0x38, 0x44, 0x44, 0x44, 0x38, 0xFC, 0x24, 0x24, 0x24, 0x18
   OLEDCHARDISP5: DB 0x18, 0x24, 0x24, 0x18, 0xFC, 0x7C, 0x08, 0x04, 0x04, 0x08, 0x48, 0x54, 0x54, 0x54, 0x20, 0x04, 0x3F, 0x44, 0x40, 0x20, 0x3C, 0x40, 0x40, 0x20, 0x7C, 0x1C, 0x20, 0x40, 0x20, 0x1C, 0x3C, 0x40, 0x30, 0x40, 0x3C, 0x44, 0x28, 0x10, 0x28, 0x44, 0x1C, 0xA0, 0xA0, 0xA0, 0x7C, 0x44, 0x64, 0x54, 0x4C, 0x44, 0x00, 0x10, 0x7C, 0x82, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x82, 0x7C, 0x10, 0x00, 0x00, 0x06, 0x09, 0x09, 0x06
	
END	